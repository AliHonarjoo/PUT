{% extends "base.html" %} {% block content %}
<h2>Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h2>

<!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙÙ„Ø´ -->
{% with messages = get_flashed_messages(with_categories=true) %} {% if messages %} {% for category, message in messages %}
<div class="alert alert-{{ category }}">{{ message }}</div>
{% endfor %} {% endif %} {% endwith %}

<form method="POST">
    {{ form.hidden_tag() }}

    <!-- ğŸ”¥ Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§Ù‡Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ -->
    {% for field in form %} {% if field.errors %}
    <div class="alert alert-danger">
        {% for error in field.errors %} {{ error }}<br> {% endfor %}
    </div>
    {% endif %} {% endfor %}

    <!-- Ø§ÛŒÙ† Ø®Ø· Ø­ÛŒØ§ØªÛŒ Ø¨ÙˆØ¯! Ø¨Ø¯ÙˆÙ† Ø§ÛŒÙ† validate_on_submit() Ù‡Ù…ÛŒØ´Ù‡ False Ø¨ÙˆØ¯ -->

    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form.first_name.label }} {{ form.first_name(class="form-control") }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.last_name.label }} {{ form.last_name(class="form-control") }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.username.label }} {{ form.username(class="form-control") }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.mobile.label }} {{ form.mobile(class="form-control") }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.password.label }} {{ form.password(class="form-control") }}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.password2.label }} {{ form.password2(class="form-control") }}
        </div>
        <div class="col-md-4 mb-3">
            {{ form.organization.label }} {{ form.organization(class="form-control", id="organization") }}
        </div>
        <div class="col-md-4 mb-3">
            {{ form.area.label }} {{ form.area(class="form-control", id="area") }}
        </div>
        <div class="col-md-4 mb-3">
            {{ form.position.label }} {{ form.position(class="form-control") }}
        </div>
    </div>
    <!-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù‚Ø´ -->
    <div class="mb-3">
        <label class="form-label">Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±</label>
        <select name="role_id" class="form-select" required>
        <option value="">--- Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù‚Ø´ ---</option>
        {% for role in roles %}
        <option value="{{ role.id }}">{{ role.name }}</option>
        {% endfor %}
    </select>
        <div class="form-text">Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</div>
    </div>
    <button type="submit" class="btn btn-success">Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±</button>
    <a href="{{ url_for('user.list') }}" class="btn btn-secondary">Ø§Ù†ØµØ±Ø§Ù</a>
</form>

<script>
    document.getElementById('organization').addEventListener('change', function() {
        const orgId = this.value;
        const areaSelect = document.getElementById('area');
        if (orgId == 0) {
            areaSelect.innerHTML = '<option value="0">Ø§Ø¨ØªØ¯Ø§ Ø³Ø§Ø²Ù…Ø§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>';
            return;
        }
        fetch(`/user/areas/${orgId}`)
            .then(r => r.json())
            .then(data => {
                areaSelect.innerHTML = '<option value="0">--- Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø§Ø­ÛŒÙ‡ ---</option>';
                data.forEach(a => {
                    areaSelect.innerHTML += `<option value="${a.id}">${a.name}</option>`;
                });
            });
    });
</script>
{% endblock %}