<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ø³Ø§Ù…Ø§Ù†Ù‡ ÙØ±Ù… Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">


    <!-- CSS Ù‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
</head>

<body class="app-container">
    <!-- Ù‡Ø¯Ø± -->
    <header class="app-header text-white p-3">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <img src="{{ url_for('static', filename='uploads/light__logo.png') }}" alt="Ù„ÙˆÚ¯Ùˆ" class="logo-img" onerror="this.style.display='none'">

            <div class="dropdown">
                <a class="text-white dropdown-toggle text-decoration-none" data-bs-toggle="dropdown">
                    {{ current_user.name }}
                </a>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Ø®Ø±ÙˆØ¬</a></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
    <main class="app-main">
        <div class="container-fluid main-wrapper">
            <div class="row flex-grow-1">
                <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
                <nav class="col-md-3 col-lg-2 sidebar p-0">
                    <div class="pt-4">
                        <div class="accordion" id="sidebarAccordion">
                            {% if current_user.is_authenticated %}

                            <!-- Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
                            {% if current_user.can_create_user and current_user.can_create_user() or current_user.can_edit_user and current_user.can_edit_user() %}
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#userCollapse">
                        ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                    </button>
                                </h2>
                                <div id="userCollapse" class="accordion-collapse collapse" data-bs-parent="#sidebarAccordion">
                                    <div class="accordion-body p-0">
                                        {% if current_user.can_create_user and current_user.can_create_user() %}
                                        <a class="nav-link" href="{{ url_for('user.create') }}" id="userCreate">â• Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±</a> {% endif %} {% if current_user.can_edit_user and current_user.can_edit_user() %}
                                        <a class="nav-link" href="{{ url_for('user.list') }}" id="userList">ğŸ“‹ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</a> {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±Ù…â€ŒÙ‡Ø§ -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#formCollapse">
                        ğŸ“ ÙØ±Ù…â€ŒÙ‡Ø§
                    </button>
                                </h2>
                                <div id="formCollapse" class="accordion-collapse collapse" data-bs-parent="#sidebarAccordion">
                                    <div class="accordion-body p-0">
                                        {% if current_user.can_create_form() %}
                                        <a class="nav-link" href="{{ url_for('form.create_matrix') }}" id="formCreate">â• Ø§ÛŒØ¬Ø§Ø¯ ÙØ±Ù…</a> {% endif %} {% if current_user.can_edit_form() %}
                                        <a class="nav-link" href="{{ url_for('form.list') }}" id="formList">ğŸ“‹ Ù„ÛŒØ³Øª ÙØ±Ù…â€ŒÙ‡Ø§</a> {% endif %}
                                        <a class="nav-link" href="/form/all_responses" id="formResponses">ğŸ“‹ ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ù¾Ø± Ø´Ø¯Ù‡</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Ø¨Ù‚ÛŒÙ‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ -->
                            {% if current_user.can_manage_settings and current_user.can_manage_settings() %}
                            <div class="accordion-item">
                                <div class="accordion-header">
                                    <a class="nav-link" href="{{ url_for('settings.logo') }}">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</a>
                                </div>
                            </div>
                            {% endif %}

                            <div class="accordion-item">
                                <div class="accordion-header">
                                    <a class="nav-link" href="{{ url_for('auth.logout') }}">ğŸšª Ø®Ø±ÙˆØ¬</a>
                                </div>
                            </div>

                            {% else %}
                            <div class="accordion-item">
                                <div class="accordion-header">
                                    <a class="nav-link" href="{{ url_for('auth.login') }}">ğŸ” ÙˆØ±ÙˆØ¯</a>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </nav>

                <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
                <section class="col-md-9 col-lg-10 main-content px-md-4 py-4">
                    {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %} {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    {% endfor %} {% endif %} {% endwith %} {% block content %}{% endblock %}
                </section>
            </div>
        </div>
    </main>

    <!-- ÙÙˆØªØ± -->
    <footer class="app-footer text-white text-center p-3">
        Â© Û±Û´Û°Û´ Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        /**
         * Auto-expand sidebar menu based on current page URL
         * Maps URLs to their corresponding sidebar collapse elements
         */
        document.addEventListener('DOMContentLoaded', function() {
            const menuMap = {
                '/user/create': {
                    collapse: 'userCollapse',
                    item: 'userCreate'
                },
                '/user/list': {
                    collapse: 'userCollapse',
                    item: 'userList'
                },
                '/form/create_matrix': {
                    collapse: 'formCollapse',
                    item: 'formCreate'
                },
                '/form/list': {
                    collapse: 'formCollapse',
                    item: 'formList'
                },
                '/form/all_responses': {
                    collapse: 'formCollapse',
                    item: 'formResponses'
                }
            };

            const currentPath = window.location.pathname;
            const menuData = menuMap[currentPath];

            if (menuData) {
                // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
                const menuElement = document.getElementById(menuData.collapse);
                if (menuElement) {
                    new bootstrap.Collapse(menuElement, {
                        show: true
                    });
                }

                // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø²ÛŒØ±Ù…Ù†Ùˆ
                const activeItem = document.getElementById(menuData.item);
                if (activeItem) {
                    activeItem.classList.add('active');
                }
            }
        });
    </script>

    {% block scripts %}{% endblock %}
</body>

</html>